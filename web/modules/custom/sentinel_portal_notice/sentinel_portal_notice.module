<?php

/**
 * @file
 * Sentinel Portal Notice module.
 */

/**
 * Implements hook_preprocess_page().
 */
function sentinel_portal_notice_preprocess_page(&$variables) {
  // Add CSS to all portal/notices pages.
  $current_path = \Drupal::service('path.current')->getPath();
  if (strpos($current_path, '/portal/notices') === 0) {
    $variables['#attached']['library'][] = 'sentinel_portal_notice/notice-styling';
  }

  $route_name = \Drupal::routeMatch()->getRouteName();
  if ($route_name === 'sentinel_portal_notice.notices' || $route_name === 'sentinel_portal_notice.notice_view') {
    static $attribute_keys = [
      'content_attributes',
      'sidebar_first_attributes',
      'sidebar_second_attributes',
      'navbar_attributes',
      'navbar_top_attributes',
    ];

    foreach ($attribute_keys as $key) {
      if (!empty($variables[$key]) && $variables[$key] instanceof \Drupal\Core\Template\Attribute) {
        $normalized = _sentinel_portal_notice_normalize_attribute_values($variables[$key]->toArray());
        $variables[$key] = new \Drupal\Core\Template\Attribute($normalized);
      }
    }
  }
}

/**
 * Normalizes attribute values to primitive types.
 *
 * @param array $values
 *   The attribute values.
 *
 * @return array
 *   Normalized attribute values.
 */
function _sentinel_portal_notice_normalize_attribute_values(array $values) {
  foreach ($values as $key => $value) {
    if ($value instanceof \Drupal\Core\Url) {
      $values[$key] = $value->toString();
    }
    elseif (is_array($value)) {
      $values[$key] = _sentinel_portal_notice_normalize_attribute_values($value);
    }
  }
  return $values;
}









